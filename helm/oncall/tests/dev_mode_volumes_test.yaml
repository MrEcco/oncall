suite: dev mode
templates:
  - celery/deployment.yaml
  - engine/deployment.yaml
release:
  name: oncall
tests:
  - it: doesn't add a volume and volume mount when oncall.devMode is disabled
    set:
      oncall:
        devMode: false
    asserts:
      - lengthEqual:
          path: spec.template.spec.containers[0].volumeMounts
          count: 2
        template: celery/deployment.yaml
      - lengthEqual:
          path: spec.template.spec.containers[0].volumeMounts
          count: 1
        template: engine/deployment.yaml
      - contains:
          path: spec.template.spec.containers[0].volumeMounts
          content:
            mountPath: /tmp
            name: tempdir
      - contains:
          path: spec.template.spec.containers[0].volumeMounts
          content:
            mountPath: /var/run/celery
            name: celery
        template: celery/deployment.yaml
      - lengthEqual:
          path: spec.template.spec.volumes
          count: 2
        template: celery/deployment.yaml
      - lengthEqual:
          path: spec.template.spec.volumes
          count: 1
        template: engine/deployment.yaml
      - contains:
          path: spec.template.spec.volumes
          content:
            name: tempdir
            emptyDir: {}
      - contains:
          path: spec.template.spec.volumes
          content:
            name: celery
            emptyDir: {}
        template: celery/deployment.yaml
